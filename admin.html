<script>
  document.addEventListener('DOMContentLoaded', () => {
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ” KEAMANAN ADMIN (inline)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const ADMIN_PASSWORD = 'herba2026';
    const ACCESS_KEY = 'herbaprima_admin_token';

    function isAuthenticated() {
      try {
        const token = localStorageACCESS_KEY);
        if (!token) return false;
        const { pass, exp } = JSON.parse(token);
        return pass === ADMIN_PASSWORD && Date.now() < exp;
      } catch (e) {
        return false;
      }
    }

    function grantAccess() {
      const expires = Date.now() + 24 * 60 * 60 * 1000;
      localStorage.setItem(ACCESS_KEY, JSON.stringify({ pass: ADMIN_PASSWORD, exp: expires }));
    }

    if (!isAuthenticated()) {
      const pass = prompt("ğŸ”’ Panel Admin Herbaprima\n\nMasukkan password:");
      if (pass !== ADMIN_PASSWORD) {
        alert("âŒ Password salah!");
        window.location.href = "index.html";
        return;
      }
      grantAccess();
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // DOM Elements
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const form = document.getElementById('productForm');
    const productIdInput = document.getElementById('productId');
    const nameInput = document.getElementById('productName');
    const categoryInput = document.getElementById('productCategory');
    const priceInput = document.getElementById('productPrice');
    const imageInput = document.getElementById('productImage');
    const descInput = document.getElementById('productDesc');
    const benefitsInput = document.getElementById('productBenefits');
    const compositionInput = document.getElementById('productComposition');
    const productTableBody = document.getElementById('productTableBody');
    const productCount = document.getElementById('productCount');

    if (!form || !productTableBody) {
      console.error("âŒ Elemen admin tidak ditemukan. Periksa HTML.");
      return;
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Load produk
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let products = JSON.parse(localStorage.getItem('herbaprimaProducts')) || [];

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Render Table
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderProductTable() {
      productTableBody.innerHTML = '';
      productCount.textContent = products.length;

      products.forEach((p, i) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><img src="${p.image}" alt="${p.name}" onerror="this.src='https://via.placeholder.com/60?text=No+Image'" /></td>
          <td><strong>${p.name}</strong></td>
          <td>${p.category}</td>
          <td>Rp ${p.price.toLocaleString('id-ID')}</td>
          <td>
            <button class="btn btn-sm btn-edit" data-index="${i}">Edit</button>
            <button class="btn btn-sm btn-delete" data-index="${i}">Hapus</button>
          </td>
        `;
        productTableBody.appendChild(row);
      });

      // Event edit/hapus
      document.querySelectorAll('.btn-edit').forEach(btn => {
        btn.addEventListener('click', e => {
          const i = e.target.dataset.index;
          fillForm(products[i], i);
        });
      });
      document.querySelectorAll('.btn-delete').forEach(btn => {
        btn.addEventListener('click', e => {
          const i = e.target.dataset.index;
          if (confirm(`Hapus "${products[i].name}"?`)) {
            products.splice(i, 1);
            saveProducts();
            renderProductTable();
          }
        });
      });
    }

    function fillForm(p, i = null) {
      productIdInput.value = i ?? '';
      nameInput.value = p.name || '';
      categoryInput.value = p.category || '';
      priceInput.value = p.price || '';
      imageInput.value = p.image || '';
      descInput.value = p.description || '';
      benefitsInput.value = p.benefits?.join(', ') || '';
      compositionInput.value = p.composition || '';
    }

    function saveProducts() {
      try {
        localStorage.setItem('herbaprimaProducts', JSON.stringify(products));
        console.log('âœ… Disimpan:', products);
      } catch (e) {
        console.error('âŒ Gagal simpan:', e);
      }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Submit Form
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    form.addEventListener('submit', e => {
      e.preventDefault();

      const name = nameInput.value.trim();
      const cat = categoryInput.value;
      const price = parseInt(priceInput.value);
      const img = imageInput.value.trim();

      if (!name || !cat || !price || !img) {
        alert('âš ï¸ Isi semua field!');
        return;
      }
      if (price < 1000) {
        alert('âš ï¸ Harga minimal Rp 1.000');
        return;
      }

      const product = {
        id: name.toLowerCase().replace(/\s+/g, '-'),
        name,
        category: cat,
        price,
        image: img,
        description: descInput.value.trim(),
        benefits: benefitsInput.value.split(',').map(b => b.trim()).filter(b => b),
        composition: compositionInput.value.trim()
      };

      const idx = productIdInput.value;
      if (idx !== '') {
        products[idx] = product;
      } else {
        products.push(product);
      }

      saveProducts();
      renderProductTable();
      form.reset();
      productIdInput.value = '';
      alert('âœ… Produk berhasil disimpan!');
    });

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Inisialisasi
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    renderProductTable();
  });
</script>
